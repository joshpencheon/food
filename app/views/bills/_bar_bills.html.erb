<% segments = [] %>

<% bar_bills.each do |bill| %>
  <% segments << {
    :proportion => bill.proportion,
    :text => bill.id
  } %>
<% end %>

<canvas id="bar_controller" width="850" height="50">
  Polite notice: your browser sucks.
</canvas>

<script type="text/javascript" charset="utf-8">
  var ctx = $('#bar_controller')[0].getContext('2d');
  
  var segments = $.parseJSON('<%= ActiveSupport::JSON.encode(segments).html_safe %>');
  var basketCost = <%= @basket.cost %>;
  
  var colors = [ '#FDD', '#DDF', '#DFD', '#FFD', '#FDA' ];
  
  var offset = 0;
  
  $.each(segments, function(index) {
    ctx.fillStyle = colors[index % colors.length];
    ctx.fillRect(offset*ctx.canvas.width/100, 0, this.proportion*ctx.canvas.width/100, ctx.canvas.height);
    
    if (index != 0) {
      ctx.fillStyle = 'lightgrey'
      ctx.fillRect(offset*ctx.canvas.width/100 - 3, 0, 6, ctx.canvas.height);
    }
    
    ctx.strokeText(
      this.text + ': Â£' + (this.proportion*basketCost/100).toFixed(2) + ' (' + this.proportion.toFixed(2) + '%)', 
      offset*ctx.canvas.width/100 + 20.5, 
      20.5);
    offset += this.proportion;
  });
  
</script>

<br/>

